# Experiment 5: Subqueries and Views

## AIM
To study and implement subqueries and views.

## THEORY

### Subqueries
A subquery is a query inside another SQL query and is embedded in:
- WHERE clause
- HAVING clause
- FROM clause

**Types:**
- **Single-row subquery**:
  Sub queries can also return more than one value. Such results should be made use along with the operators in and any.
- **Multiple-row subquery**:
  Here more than one subquery is used. These multiple sub queries are combined by means of ‘and’ & ‘or’ keywords.
- **Correlated subquery**:
  A subquery is evaluated once for the entire parent statement whereas a correlated Sub query is evaluated once per row processed by the parent statement.

**Example:**
```sql
SELECT * FROM employees
WHERE salary > (SELECT AVG(salary) FROM employees);
```
### Views
A view is a virtual table based on the result of an SQL SELECT query.
**Create View:**
```sql
CREATE VIEW view_name AS
SELECT column1, column2 FROM table_name WHERE condition;
```
**Drop View:**
```sql
DROP VIEW view_name;
```

**Question 1**
--
Write a SQL query that retrieves the all the columns from the Table Grades, where the grade is equal to the minimum grade achieved in each subject.


```sql
SELECT g.*
FROM Grades g
WHERE g.grade = (
    SELECT MIN(g2.grade)
    FROM Grades g2
    WHERE g2.subject = g.subject
);
```

**Output:**

<img width="1200" height="444" alt="image" src="https://github.com/user-attachments/assets/6a090e38-e076-41a9-becd-9eb8a55cf357" />

**Question 2**
---
From the following tables, write a SQL query to find all orders generated by the salespeople who may work for customers whose id is 3007. Return ord_no, purch_amt, ord_date, customer_id, salesman_id.


```sql
SELECT o.ord_no, o.purch_amt, o.ord_date, o.customer_id, o.salesman_id
FROM orders o
WHERE o.salesman_id IN (
    SELECT salesman_id
    FROM orders
    WHERE customer_id = 3007
);
```

**Output:**

<img width="1153" height="441" alt="image" src="https://github.com/user-attachments/assets/e690b203-0dc8-4a89-a5ea-92eb4e906b22" />

**Question 3**
---
Write a query to display all the customers whose ID is the difference between the salesperson ID of Mc Lyon and 2001.


```sql
SELECT *
FROM customer
WHERE customer_id = (
    SELECT salesman_id - 2001
    FROM salesman
    WHERE name = 'Mc Lyon'
);
```

**Output:**

<img width="1140" height="277" alt="image" src="https://github.com/user-attachments/assets/063dce7a-02fa-464e-b1ec-430db41c8210" />

**Question 4**
---
Write a SQL query to Retrieve the names and cities of customers who have the same city as customers with IDs 3 and 7


```sql
SELECT name, city
FROM customer
WHERE city IN (
    SELECT city
    FROM customer
    WHERE id IN (3, 7)
);
```

**Output:**

<img width="483" height="385" alt="image" src="https://github.com/user-attachments/assets/08b06df9-6486-4917-8bfa-2f32b9f670ed" />

**Question 5**
---
Write a SQL query to Find employees who have an age less than the average age of employees with incomes over 1 million


```sql
SELECT *
FROM Employee
WHERE age < (
    SELECT AVG(age)
    FROM Employee
    WHERE income > 1000000
);
```

**Output:**

<img width="1230" height="355" alt="image" src="https://github.com/user-attachments/assets/b2089b6d-8437-4089-9381-9ae206031716" />

**Question 6**
---
From the following tables write a SQL query to find salespeople who had more than one customer. Return salesman_id and name.


```sql
SELECT s.salesman_id, s.name
FROM salesman s
JOIN customer c ON s.salesman_id = c.salesman_id
GROUP BY s.salesman_id, s.name
HAVING COUNT(c.customer_id) > 1;
```

**Output:**

<img width="512" height="408" alt="image" src="https://github.com/user-attachments/assets/e83b9af2-984e-4199-b2fe-d85912a74a9f" />

**Question 7**
---
Write a SQL query to Find employees who have an age less than the average age of employees with incomes over 2.5 Lakh


```sql
SELECT id, name, age, city, income
FROM Employee
WHERE age < (
    SELECT AVG(age)
    FROM Employee
    WHERE income > 250000
);
```

**Output:**

<img width="1269" height="465" alt="image" src="https://github.com/user-attachments/assets/1b404d58-fc6d-4565-ada7-6e13d39a0053" />

**Question 8**
---
Write a SQL query that retrieves the names of students and their corresponding grades, where the grade is equal to the maximum grade achieved in each subject.


```sql
SELECT g.student_name, g.grade
FROM GRADES g
WHERE g.grade = (
    SELECT MAX(g2.grade)
    FROM GRADES g2
    WHERE g2.subject = g.subject
);
```

**Output:**

<img width="689" height="363" alt="image" src="https://github.com/user-attachments/assets/beee67b8-b78f-4306-955d-35770a1b41f0" />

**Question 9**
---
From the following tables write a SQL query to find the order values greater than the average order value of 10th October 2012. Return ord_no, purch_amt, ord_date, customer_id, salesman_id.


```sql
SELECT ord_no, purch_amt, ord_date, customer_id, salesman_id
FROM orders
WHERE purch_amt > (
    SELECT AVG(purch_amt)
    FROM orders
    WHERE ord_date = '2012-10-10'
);
```

**Output:**

<img width="1124" height="403" alt="image" src="https://github.com/user-attachments/assets/a205f5bc-a4a4-493e-82b9-c881476c2640" />

**Question 10**
---
Write a SQL query to retrieve all columns from the CUSTOMERS table for customers whose salary is greater than $4500.


```sql
SELECT *
FROM CUSTOMERS
WHERE SALARY > 4500;
```

**Output:**

<img width="1080" height="368" alt="image" src="https://github.com/user-attachments/assets/5125f1fb-58b2-40f2-bb13-a983e69bf67e" />


## RESULT
Thus, the SQL queries to implement subqueries and views have been executed successfully.
